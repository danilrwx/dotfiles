#!/bin/bash

vol() {
  icon="üîä"
  vol=`pactl get-sink-volume @DEFAULT_SINK@ | awk '{ print $5 }'`

  muted=`pactl get-sink-mute @DEFAULT_SINK@ | awk '{ print $2 }'`
  [[ $muted = "yes" ]] && icon="üîá"

  echo -e " $icon$vol"
}

mic() {
  icon="üéôÔ∏è"
  vol=`pactl get-source-volume @DEFAULT_SOURCE@ | awk '{ print $5 }'`

  muted=`pactl get-source-mute @DEFAULT_SOURCE@ | awk '{ print $2 }'`
  [[ $muted = "yes" ]] && icon="üôä"

  echo -e " $icon$vol"
}

bat_icon() {
  local bat="/sys/class/power_supply/BAT$1"
  local vol="$(cat "$bat/capacity")"
  local status="$(cat "$bat/status")"

  local result="Û∞Åπ"
  [[ $status = "Charging" ]] && result="Û∞ÇÖ"

  if [[ $vol -lt 90 ]]; then
    result="Û∞ÇÇ"
    [[ $status = "Charging" ]] && result="Û∞Çã"
  fi

  if [[ $vol -lt 80 ]]; then
    result="Û∞ÇÅ"
    [[ $status = "Charging" ]] && result="Û∞Çä"
  fi

  if [[ $vol -lt 70 ]]; then
    result="Û∞ÇÄ"
    [[ $status = "Charging" ]] && result="Û∞¢û"
  fi

  if [[ $vol -lt 60 ]]; then
    result="Û∞Åø"
    [[ $status = "Charging" ]] && result="Û∞Çâ"
  fi

  if [[ $vol -lt 50 ]]; then
    result="Û∞Åæ"
    [[ $status = "Charging" ]] && result="Û∞¢ù"
  fi

  if [[ $vol -lt 40 ]]; then
    result="Û∞ÅΩ"
    [[ $status = "Charging" ]] && result="Û∞Çà"
  fi

  if [[ $vol -lt 30 ]]; then
    result="Û∞Åº"
    [[ $status = "Charging" ]] && result="Û∞Çá"
  fi

  if [[ $vol -lt 20 ]]; then
    result="Û∞Åª"
    [[ $status = "Charging" ]] && result="Û∞ÇÜ"
  fi

  if [[ $vol -lt 10 ]]; then
    result="Û∞Å∫"
    [[ $status = "Charging" ]] && result="Û∞¢ú"
  fi

  echo "$result"
}

bat0() {
  res=""

  if [[ -d /sys/class/power_supply/BAT0/ ]]; then
    bat0=`cat /sys/class/power_supply/BAT0/capacity`
    icon0="$(bat_icon 0)"
    res+="$icon0 $bat0%"

    echo -e " $(del)$res"
  fi
}

bat1() {
  res=""

  if [[ -d /sys/class/power_supply/BAT1/ ]]; then
    bat1=`cat /sys/class/power_supply/BAT1/capacity`
    icon1="$(bat_icon 1)"
    res+="$icon1 $bat1%"

    echo -e " $(del)$res"
  fi
}

bri() {
  if [[ -e /usr/bin/brightnessctl ]]; then
    c=`brightnessctl get`
    m=`brightnessctl max`
    bri=`printf "%.0f" $(echo "scale=1; ($c / $m) * 100" | bc)`
    echo -e "$(del) üåû$bri%"
  fi
}

del() {
  echo -e " "
}

datef() {
  val=`date +'%d/%m/%Y %H:%M'`

  echo -e "$val"
}

mem() {
  val=`free -h | awk '/Mem/{print $3}'`
  icon="üß†"

  echo -e " $icon$val"
}

keyboard() {
  icon="Û∞åå"
  text=`xkblayout-state print "%s" | awk '{print toupper($0)}'`

  if [[ $text = "US" ]]; then
    icon="üá∫üá∏"
  elif [[ $text = "RU" ]]; then
    icon="üá∑üá∫"
  fi

  echo -e " $icon$text"
}

SLEEP_SEC=1
while true; do
  echo "$(mem)$(del)$(vol)$(del)$(mic)$(bat0)$(bat1)$(bri)$(del)$(keyboard)$(del)$(datef)"
  xsetroot -name "$(mem)$(del)$(vol)$(del)$(mic)$(bat0)$(bat1)$(bri)$(del)$(keyboard)$(del)$(datef)"
  sleep $SLEEP_SEC
done
